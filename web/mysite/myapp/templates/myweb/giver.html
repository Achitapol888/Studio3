{% extends 'myweb/base2.html' %}

{% load static %}

{% block title %}
ผู้ให้
{% endblock %}

{% block background_style %}
background-color: rgba(0, 0, 0);
{% endblock %}

{% block styles %}
<!-- Add more CSS files here -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
    .drag-drop-area {
        border: 2px dashed #007bff; /* Bootstrap primary color */
        border-radius: 10px;
        padding: 60px; /* Increased padding for a larger area */
        text-align: center;
        transition: background-color 0.3s;
        min-height: 250px; /* Set a minimum height for better appearance */
    }
    .drag-drop-area.hover {
        background-color: rgba(0, 123, 255, 0.1); /* Light blue on hover */
    }
    #preview {
        width: 200px; /* Increased width for the preview image */
        height: 200px; /* Set a height for the preview image */
        object-fit: cover; /* Ensure the image covers the area nicely */
        display: block; /* Ensure it's displayed as a block element */
        margin: 0 auto; /* Center the image */
    }
</style>
{% endblock %}

{% block content %}      
    <div class="container my-4">
        <div class="bg-light rounded-5 shadow-sm p-4">
            <div class="row">
                <div class="col-lg-6">
                    <div class="card mb-4">
                        <div class="card-body text-center">
                            <div id="drag-drop-area" class="drag-drop-area">
                                <img id="preview" src="{% static 'images/icon_accout.png' %}" style="display: none;">
                                <p class="mt-4">ลากและวางหรือคลิกเพื่ออัปโหลดรูปภาพ</p>
                                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                                 <!-- Undo Button -->
                                <button id="undoButton" class="btn btn-danger mt-3" style="display: none;" onclick="undoUpload()">ย้อนกลับ</button>
                            </div>                       
                        </div>
                    </div>
                    <div>
                        <!-- Checkbox -->
                        <div class="form-check mb-4">
                            <input type="checkbox" class="form-check-input" id="tradeConfirmation" required>
                            <label class="form-check-label" for="tradeConfirmation">
                                ยืนยันว่าการให้สิ่งของครั้งนี้จะไม่มีการซื้อขาย
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <div class="card mb-4">
                        <div class="card-body">
                            <form id="giverForm">
                                <div class="row mb-3">
                                    <div class="col-sm-4">
                                        <label for="itemName" class="mb-0">ชื่อสิ่งของ</label>
                                    </div>
                                    <div class="col-sm-8">
                                        <input type="text" id="itemName" class="form-control" placeholder="เช่น พัดลม, ลิฟสติก, ชื่อหนังสือ" required>
                                    </div>
                                </div>
                                <hr>
                                <div class="row mb-3">
                                    <div class="col-sm-4">
                                        <label for="itemType" class="mb-0">ประเภท</label>
                                    </div>
                                    <div class="col-sm-8">
                                        <select id="itemType" class="form-control" required>
                                            <option value="electronic">เครื่องใช้ไฟฟ้า</option>
                                            <option value="clothes">เสื้อผ้า</option>
                                            <option value="beauty">อุปกรณ์เสริมสวย</option>
                                            <option value="book">หนังสือ</option>
                                            <option value="kitchenware">เครื่องครัว</option>
                                            <option value="furniture">เฟอร์นิเจอร์</option>
                                            <option value="Pet_care">อุปกรณ์สำหรับสัตว์เลี้ยง</option>
                                        </select>
                                    </div>
                                </div>
                                <hr>
                                <div class="row mb-3">
                                    <div class="col-sm-4">
                                        <label for="description" class="mb-0">รายละเอียด</label>
                                    </div>
                                    <div class="col-sm-8">
                                        <textarea id="description" class="form-control" placeholder="เช่น ชื่อรุ่น ,ยี่ห้อ เเละอื่น ๆ" rows="3" required></textarea>
                                    </div>
                                </div>
                                <hr>
                                <div class="row mb-3">
                                    <div class="col-sm-4">
                                        <label for="condition" class="mb-0">ตำหนิ</label>
                                    </div>
                                    <div class="col-sm-8">
                                        <input type="text" id="condition" class="form-control" placeholder="เช่น มีตำหนิที่ใดบ้าง" required>
                                    </div>
                                </div>
                                <hr>
                                <div class="row mb-3">
                                    <div class="col-sm-4">
                                        <label for="location" class="mb-0">สถานที่ให้สิ่งของ</label>
                                    </div>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" placeholder="กรุณาระบุอย่างละเอียด" required readonly>
                                    </div>
                                </div>
                                <hr>
                                <div class="row mb-3">
                                    <div class="col-sm-4">
                                        <label for="date" class="mb-0">วันเวลา</label>
                                    </div>
                                    <div class="col-sm-8">
                                        <input type="datetime-local" id="date" class="form-control" required>
                                        <div id="formattedDate" class="mt-2 text-secondary"></div> <!-- Display formatted date -->
                                    </div>
                                </div>
                                
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- process Button -->
            <div class="text-end">
                <a href="#" id="nextButton" class="btn btn-primary btn-lg disabled mb-2 mt-1 fs-4" onclick="handleNextButtonClick(event)">เริ่มต้นกระบวนการ</a>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
<script>
    const dragDropArea = document.getElementById('drag-drop-area');
    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('preview');
    const nextButton = document.getElementById('nextButton');
    const undoButton = document.getElementById('undoButton');

    // Handle file selection and drag-and-drop
    dragDropArea.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', handleFileSelect);
    dragDropArea.addEventListener('dragover', (event) => {
        event.preventDefault();
        dragDropArea.classList.add('hover');
    });

    dragDropArea.addEventListener('dragleave', () => {
        dragDropArea.classList.remove('hover');
    });

    dragDropArea.addEventListener('drop', (event) => {
        event.preventDefault();
        dragDropArea.classList.remove('hover');
        const files = event.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files; // Set the file input files
            handleFileSelect(); // Preview the file
        }
    });

    function handleFileSelect() {
        const file = fileInput.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result; // Set the image source to the preview
                preview.style.display = 'block'; // Show the image
                nextButton.classList.remove('disabled'); // Enable the next button
                undoButton.style.display = 'inline-block'; // Show the undo button
            };
            reader.readAsDataURL(file);
        }
    }

    // Undo function to clear the image and reset the input
    function undoUpload() {
        preview.src = ''; // Clear the image preview
        preview.style.display = 'none'; // Hide the image
        fileInput.value = ''; // Clear the file input
        nextButton.classList.add('disabled'); // Disable the next button
        undoButton.style.display = 'none'; // Hide the undo button
    }

    // Prevent default form submission on clicking the button
    document.getElementById('nextButton').addEventListener('click', function (event) {
        event.preventDefault();
        const form = document.getElementById('giverForm');
        if (form.checkValidity()) {
            // Here you can handle form submission, e.g., using AJAX or redirection
            alert("Form submitted!"); // Placeholder for actual submission logic
        }
    });

    const dateInput = document.getElementById('date');
    const formattedDateDisplay = document.getElementById('formattedDate');
    
    dateInput.addEventListener('change', function() {
        const selectedDate = new Date(dateInput.value);
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long', hour: '2-digit', minute: '2-digit', timeZone: 'Asia/Bangkok', hour12: false };
        const thaiFormattedDate = new Intl.DateTimeFormat('th-TH', options).format(selectedDate);
        formattedDateDisplay.textContent = `วันที่เลือก: ${thaiFormattedDate}`;
    });
    
</script>
{% endblock %}
